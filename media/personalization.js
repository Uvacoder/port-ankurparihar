var user,repos,status,access_token,gitddb=!1,config_file_path="/git-ddb-ankurparihar.json",default_config={"--theme-color":"#f3c669","--theme-color-rgb":[243,198,105]},config_file_sha=null,successfull_sign_in=null,config_data=JSON.parse(JSON.stringify(default_config)),getUserStatus=null,menu_visible=!1;function resetConfig(){deleteCookie("theme"),user=null,repos=null,status=null,gitddb=!1,access_token=null,config_file_sha=null,config_data=JSON.parse(JSON.stringify(default_config))}function setCookie(e,t,n){var o=new Date;o.setTime(o.getTime()+864e5*n);var i="expires="+o.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}function getCookie(e){var t,n,o=!1;return document.cookie.split(";").forEach(i=>{if(!o){var s=i.split("=");if(2==s.length&&([t,n]=[s[0].trim(),s[1].trim()],t==e))return o=!0,n}}),o?n:""}function deleteCookie(e){setCookie(e,"",-1)}function getUser(){fetch("https://api.github.com/user",{headers:{Authorization:"token "+access_token}}).then(e=>e.json()).then(e=>e.message?(getUserStatus=!1,successfull_sign_in=!1,!1):(user=e).login&&""!=user.login?(console.log("AUTH_INFO: User info fetched"),checkGDDBRepo(),getUserStatus=!0,!0):(console.log("AUTH_ERR : Could not fetch user info"),user=null,getUserStatus=!1,successfull_sign_in=!1,!1))}function getReposList(){return fetch("https://api.github.com/user/repos?type=private",{headers:{Authorization:"token "+access_token}}).then(e=>e.json()).then(e=>{repos=e}),!0}function checkGDDBRepo(){fetch("https://api.github.com/repos/"+user.login+"/git-ddb",{headers:{Authorization:"token "+access_token}}).then(e=>e.json()).then(e=>{if("Not Found"==e.message)return gitddb=!1,console.log("AUTH_WARN: git-ddb repository not found"),console.log("AUTH_INFO: creating git-ddb repository"),createGDDBRepo(),successfull_sign_in=!1,!1;gitddb=!0,console.log("AUTH_INFO: git-ddb repository found"),getConfig()})}function createGDDBRepo(){fetch("https://api.github.com/user/repos",{method:"POST",headers:{Authorization:"token "+access_token},body:JSON.stringify({name:"git-ddb",description:"Github Distrubuted Database Global Repository",private:!0,has_issues:!1,has_projects:!1,has_wiki:!1,auto_init:!0})}).then(e=>e.json()).then(e=>e.errors?"name already exists on this account"==e.errors[0].message?(gitddb=!0,console.log("AUTH_INFO: Already exists git-ddb repository"),getConfig(),!0):(gitddb=!1,console.log("AUTH_ERR : Could not create git-ddb repository"),successfull_sign_in=!1,!1):e.id?(gitddb=!0,console.log("AUTH_INFO: Created git-ddb repository"),getConfig(),!0):void 0)}function getConfig(){fetch("https://api.github.com/repos/"+user.login+"/git-ddb/contents"+config_file_path,{headers:{Authorization:"token "+access_token}}).then(e=>e.json()).then(e=>"Not Found"==e.message?(console.log("AUTH_WARN: could not find setting file on remote"),config_file_sha="",successfull_sign_in=!1,!1):(config_data=JSON.parse(atob(e.content)),console.log("AUTH_INFO: found settings file on remote"),config_file_sha=e.sha,cookiefieConfig(),applyConfig(),successfull_sign_in=!0,!0))}function createConfig(){fetch("https://api.github.com/repos/"+user.login+"/git-ddb/contents"+config_file_path,{method:"PUT",headers:{Authorization:"token "+access_token},body:JSON.stringify({message:"set by @ankurparihar",content:btoa(JSON.stringify(config_data))})}).then(e=>e.json()).then(e=>(console.log(e),e.message?(console.log("AUTH_ERR : could not create setting file on remote"),config_file_sha=null,successfull_sign_in=!1,!1):(console.log("AUTH_INFO: created setting file on remote"),config_file_sha=e.content.sha,cookiefieConfig(),applyConfig(),successfull_sign_in=!0,!0)))}function updateConfig(){fetch("https://api.github.com/repos/"+user.login+"/git-ddb/contents"+config_file_path,{method:"PUT",headers:{Authorization:"token "+getCookie("access_token")},body:JSON.stringify({message:"set by @ankurparihar",content:btoa(JSON.stringify(config_data)),sha:config_file_sha})}).then(e=>e.json()).then(e=>!e.message&&(console.log(e),!0))}function applyConfig(){var e=document.documentElement;config_data["--theme-color"]&&e.style.setProperty("--theme-color",config_data["--theme-color"]),config_data["--theme-color-rgb"]&&(e.style.setProperty("--theme-color-r",config_data["--theme-color-rgb"][0]),e.style.setProperty("--theme-color-g",config_data["--theme-color-rgb"][1]),e.style.setProperty("--theme-color-b",config_data["--theme-color-rgb"][2])),console.log("AUTH_INFO: configuration applied")}function cookiefieConfig(){config_data["--theme-color-rgb"]&&setCookie("theme",JSON.stringify({"--theme-color-rgb":config_data["--theme-color-rgb"],"--theme-color":config_data["--theme-color"]}),30),console.log("AUTH_INFO: Settings saved in cookies")}function decookiefieConfig(){var e=getCookie("theme");return null!=e&&""!=e&&(e=JSON.parse(e),config_data["--theme-color-rgb"]=e["--theme-color-rgb"],config_data["--theme-color"]=e["--theme-color"],!0)}function checkAccessToken(){return!!(access_token=getCookie("access_token"))}function signOut(){deleteCookie("access_token"),deleteCookie("theme"),console.log("AUTH_INFO: Deleted all settings and access token"),successfull_sign_in=null,resetConfig(),applyConfig(),console.log("AUTH_INFO: Applied default config"),setSignOutStatus()}function applyAuth(){if(console.log("AUTH_INFO: checking sign info"),!checkAccessToken())return console.log("AUTH_ERR : Access token not found"),void setSignOutStatus();if(console.log("AUTH_INFO: Access token found"),!decookiefieConfig())return console.log("AUTH_ERR : No cookies found for settings"),void setSignOutStatus();console.log("AUTH_INFO: Found saved settings in cookies"),applyConfig(),getUser();var e=setInterval(function(){!1!==getUserStatus&&!0!==getUserStatus||(clearInterval(e),!1!==getUserStatus&&user?user.avatar_url&&setSignInStatus():setSignOutStatus(),getUserStatus=null)},1e3)}function toggleAccountMenu(e){var t=document.querySelector(".application .menu__content.user_options");"close"==e?menu_visible=!0:"open"==e&&(menu_visible=!1),t.style.display=!1===menu_visible?"block":"none",menu_visible=!menu_visible}function setSignInStatus(){document.querySelector(".toolbar .user-options").innerHTML='<div class="menu" style="display:inline-block;"><div class="menu__activator"><button type="button" class="avatar-container btn btn--icon btn--large" style="position: relative" onclick="toggleAccountMenu()"><div class="btn__content"><div class="avatar" style="background:transparent url(\''+user.avatar_url.split("?")[0]+"?s=48') center center / cover;\"></div></div></button></div></div>";var e=document.querySelector("#nav-sign-in").parentElement.parentElement.parentElement;e.querySelector("#nav-sign-in").parentElement.parentElement.style.display="none",e.querySelector("#nav-acc-setting").parentElement.parentElement.style.display="block",e.querySelector("#nav-switch-acc").parentElement.parentElement.style.display="block",e.querySelector("#nav-sign-out").parentElement.parentElement.style.display="block";var t=document.querySelector(".application .menu__content.user_options");t.style.display="none",t.innerHTML='<div class="user_options__top_wrapper"><div class="user_options__top flex row align-center"><button type="button" class="btn btn--icon btn--large avatar-container" style="position:relative"><div class="btn__content"><div class="avatar" style="background: transparent url('+user.avatar_url.split("?")[0]+'?s=44) center center / cover"></div></div></button><div class="user_options__top__nameemail flex column justify-center align-left"><div class="nameemail__name cut_text">'+user.name+'</div><div class="nameemail__email cut_text">'+user.login+'</div></div></div></div><div class="list user_options__list"><a class="list__tile list__tile--link" href="javascript:{toggleAccountMenu();loadDoc(\'/account\', \'nav-acc-setting\')}"><div class="list__tile__action"><svg style="width:24px;height:24px" fill="currentColor" viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/></svg></div><div class="list__tile__content"><div class="list__tile__title">My account</div></div></a><a class="list__tile list__tile--link" href="javascript:{toggleAccountMenu();loadDoc(\'/sign-in/index.html\', \'nav-switch-acc\')}"><div class="list__tile__action"><svg style="width:24px;height:24px" fill="currentColor" viewBox="0 0 24 24"><path d="M16,9C18.33,9 23,10.17 23,12.5V15H17V12.5C17,11 16.19,9.89 15.04,9.05L16,9M8,9C10.33,9 15,10.17 15,12.5V15H1V12.5C1,10.17 5.67,9 8,9M8,7A3,3 0 0,1 5,4A3,3 0 0,1 8,1A3,3 0 0,1 11,4A3,3 0 0,1 8,7M16,7A3,3 0 0,1 13,4A3,3 0 0,1 16,1A3,3 0 0,1 19,4A3,3 0 0,1 16,7M9,16.75V19H15V16.75L18.25,20L15,23.25V21H9V23.25L5.75,20L9,16.75Z" /></svg></div><div class="list__tile__content"><div class="list__tile__title">Switch account</div></div></a><a class="list__tile list__tile--link" href="javascript:{toggleAccountMenu();signOut();}"><div class="list__tile__action"><svg style="width:24px;height:24px" fill="currentColor" viewBox="0 0 24 24"><path d="M16.56,5.44L15.11,6.89C16.84,7.94 18,9.83 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12C6,9.83 7.16,7.94 8.88,6.88L7.44,5.44C5.36,6.88 4,9.28 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12C20,9.28 18.64,6.88 16.56,5.44M13,3H11V13H13" /></svg></div><div class="list__tile__content"><div class="list__tile__title">Sign out</div></div></a></div>'}function setSignOutStatus(){document.querySelector(".toolbar .user-options").innerHTML='<button type="button" class="transparent logo-text-btn log-in-text btn btn-large" style="position: relative;" onclick="javascript:loadDoc(\'/sign-in/index.html\', \'nav-sign-in\')"><div class="btn-content"><span>SIGN IN</span></div></button>';var e=document.querySelector("#nav-sign-in").parentElement.parentElement.parentElement;e.querySelector("#nav-sign-in").parentElement.parentElement.style.display="block",e.querySelector("#nav-acc-setting").parentElement.parentElement.style.display="none",e.querySelector("#nav-switch-acc").parentElement.parentElement.style.display="none",e.querySelector("#nav-sign-out").parentElement.parentElement.style.display="none",toggleAccountMenu("close")}applyAuth();